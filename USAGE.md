# Инструкция по использованию Shopping Bot

## Настройка

1. **Клонирование репозитория**
   ```bash
   git clone https://github.com/yourusername/shopping-bot.git
   cd shopping-bot
   ```

2. **Установка зависимостей**
   ```bash
   npm install
   ```

3. **Настройка переменных окружения**
   - Скопируйте файл `.env.example` в `.env`:
     ```bash
     cp .env.example .env
     ```
   - Отредактируйте файл `.env`, указав свои данные:
     - Настройки электронной почты для уведомлений
     - Учетные данные для магазинов (если требуется)
     - API ключ OpenAI для анализа скриншотов с помощью ИИ

## Настройка продуктов для мониторинга

Отредактируйте файл `config/default.js`, добавив продукты, которые вы хотите отслеживать:

```javascript
targetItems: [
  {
    shop: 'Zara',
    name: 'Название продукта',
    productId: 'ua/uk/путь-к-продукту-p12345678', // ID продукта из URL
    sizes: ['XS', 'S', 'M'], // Желаемые размеры
    maxPrice: 1500, // Максимальная цена
    autoPurchase: false // Автоматическая покупка (пока не реализовано)
  },
  // Добавьте больше продуктов...
]
```

### Как найти productId

1. Откройте страницу продукта в браузере
2. Скопируйте часть URL после домена и перед `.html`
   - Например, из URL `https://www.zara.com/ua/uk/название-продукта-p12345678.html`
   - productId будет: `ua/uk/название-продукта-p12345678`

## Запуск бота

### Обычный запуск
```bash
npm start
```

### Запуск в режиме разработки (с автоматической перезагрузкой)
```bash
npm run dev
```

## Функциональность AI-анализа

Бот использует OpenAI API для анализа скриншотов страниц продуктов. Это позволяет:

1. **Адаптироваться к изменениям в структуре сайта** - даже если магазин изменит HTML-структуру, бот все равно сможет определить доступность продукта.
2. **Определять цены и размеры** - ИИ анализирует изображение и извлекает информацию о ценах и доступных размерах.
3. **Работать с разными магазинами** - один и тот же код может работать с разными магазинами без необходимости настраивать селекторы для каждого.

### Настройка AI-анализа

1. Получите API ключ от OpenAI: [https://platform.openai.com/api-keys](https://platform.openai.com/api-keys)
2. Добавьте ключ в файл `.env`:
   ```
   OPENAI_API_KEY=your-openai-api-key
   ```

### Резервный механизм

Если AI-анализ не удается (например, из-за проблем с API или отсутствия ключа), бот автоматически переключается на традиционный анализ HTML-структуры.

## Логи и отладка

Логи сохраняются в директории `logs`:
- `combined.log` - все логи
- `error.log` - только ошибки

Скриншоты сохраняются в директории `screenshots` с временными метками и описательными именами.

## Расписание проверок

По умолчанию бот проверяет доступность продуктов каждые 30 минут. Вы можете изменить это расписание в файле `.env`, изменив переменную `CHECK_INTERVAL`. Формат соответствует cron-выражениям:

```
CHECK_INTERVAL="*/30 * * * *"  # Каждые 30 минут
```

Другие примеры:
- `"0 * * * *"` - каждый час в начале часа
- `"0 */2 * * *"` - каждые 2 часа
- `"0 9,18 * * *"` - в 9:00 и 18:00 каждый день

## Устранение неполадок

### Проблема: Бот не может найти продукт
- Убедитесь, что productId указан правильно
- Проверьте, что продукт все еще существует на сайте
- Проверьте логи на наличие ошибок

### Проблема: AI-анализ не работает
- Убедитесь, что ваш API ключ OpenAI действителен и правильно настроен
- Проверьте, что у вас достаточно средств на счету OpenAI
- Проверьте логи на наличие ошибок API

### Проблема: Уведомления по электронной почте не отправляются
- Убедитесь, что настройки электронной почты в `.env` правильные
- Для Gmail убедитесь, что вы используете пароль приложения, а не обычный пароль
- Проверьте логи на наличие ошибок отправки почты 