# Работа с общими директориями в Shopping Bot

В проекте Shopping Bot используются общие директории для обмена данными между контейнерами. 

## Структура директорий

В системе используются следующие общие директории:

1. `logs` - для хранения логов.
2. `screenshots` - для хранения скриншотов товаров.
3. `status` - для хранения данных о состоянии бота.

## Описание монтирования директорий

### Контейнер shopping-bot

```yaml
volumes:
  - ./config:/app/config
  - ./logs:/app/logs
  - ./screenshots:/app/screenshots
  - ./status:/app/status
  - ./.env:/app/.env
```

Контейнер с ботом сохраняет:
- Скриншоты в директорию `screenshots` на хост-системе
- Данные о состоянии в директорию `status` на хост-системе

### Контейнер nginx

```yaml
volumes:
  - ./html:/usr/share/nginx/html
  - ./nginx/conf.d:/etc/nginx/conf.d
  - shopping-bot_logs:/var/log/nginx
  - ./screenshots:/usr/share/nginx/html/screenshots:ro
  - ./status:/usr/share/nginx/html/status
```

Контейнер nginx:
- Получает доступ к скриншотам из директории `screenshots` в режиме только для чтения (`:ro`)
- Получает доступ к данным о состоянии из директории `status`

## Преимущества использования общих директорий

1. **Простота**: Нет необходимости управлять Docker томами
2. **Наглядность**: Все файлы доступны напрямую в файловой системе хоста
3. **Удобство отладки**: Можно просматривать и редактировать файлы без доступа к контейнерам
4. **Независимость**: Контейнеры могут перезапускаться независимо друг от друга

## Данные, хранящиеся в директориях

### screenshots

Содержит скриншоты страниц товаров, сделанные ботом. Используются для:
- Визуальной верификации доступности товаров
- Отображения в веб-интерфейсе
- Анализа с помощью AI (при активации этой функции)

### status

Содержит файл `status.json` со структурой:
```json
{
  "lastCheck": "2023-11-01T12:34:56.789Z",
  "botStatus": "running",
  "products": [
    {
      "name": "Название товара",
      "shop": "Имя магазина",
      "sizes": ["XL", "XXL"],
      "maxPrice": 15000,
      "available": false,
      "price": null,
      "availableSizes": [],
      "error": null,
      "lastChecked": "2023-11-01T12:34:56.789Z"
    }
  ],
  "notifications": [
    {
      "id": 1698842096789,
      "title": "Заголовок уведомления",
      "message": "Текст уведомления",
      "timestamp": "2023-11-01T12:34:56.789Z"
    }
  ]
}
```

## Управление доступом

### Права доступа

При работе на Linux может потребоваться настройка прав доступа:

```bash
# Предоставление прав на запись для контейнеров
chmod -R 777 screenshots status
```

### Проблемы с владельцем файлов

Если файлы создаются с правами root, что мешает их редактированию:

```bash
# Изменение владельца файлов на текущего пользователя
sudo chown -R $(whoami):$(whoami) screenshots status
```

## Устранение неполадок

Если веб-интерфейс не отображает скриншоты или данные о состоянии:

1. Проверьте, что директории существуют и имеют правильные права доступа:
```bash
ls -la screenshots status
```

2. Проверьте, что директории правильно примонтированы к контейнерам:
```bash
docker-compose -f docker-compose.development.yml config
```

3. Проверьте, что файлы создаются в этих директориях:
```bash
ls -la screenshots
ls -la status
```

4. Перезапустите контейнеры для применения изменений:
```bash
docker-compose -f docker-compose.development.yml restart
```
